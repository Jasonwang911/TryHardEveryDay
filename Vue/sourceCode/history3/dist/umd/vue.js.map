{"version":3,"file":"vue.js","sources":["../../src/observe/array.js","../../src/utils/index.js","../../src/observe/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 重写是数组的方法是会导致数组本身发生变化的方法： push shift unshift pop resverse sort splice\r\n// slice() 等方法不会导致数组本身发生变化，所以不需要重写\r\n\r\n// 先把数组原型上的真实方法都存起来\r\nlet oldArrayMethods = Array.prototype\r\n// 创建新的数组的方法，并且可以通过 arrayMethods.__proto__ = oldArrayMethods 找到原来数组上的方法\r\n// 这样延长了原型链，用户调用数组的方法，会通过  value.__proto__ = arrayMethods 查找 arrayMethods 上的7个方法，其他的方法在 arrayMethods 上面不能找到，便会通过原型链 __proto__ 继续向上查找到oldArrayMethods  从而得到调用\r\nexport let arrayMethods = Object.create(oldArrayMethods)\r\n\r\nconst methods = [\r\n  'push',\r\n  'shift',\r\n  'unshift',\r\n  'pop',\r\n  'resverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  // AOC 面向切片编程\r\n  arrayMethods[method] = function(...args) {   \r\n    // args是个类数组\r\n    console.log(`用户调用了${method}方法`)\r\n    // 调用原生数组的方法病返回结果\r\n    const result = oldArrayMethods[method].apply(this, args)  \r\n    // 被添加的属性需要继续呗观测\r\n    let inserted\r\n    let ob = this.__ob__\r\n    switch(method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args;\r\n        break;\r\n      case 'splice':   //  splice有3个属性  新增  修改 和删除 新增 arr.splice(arr, i, {name: 'xiaokui'})\r\n        inserted = args.slice(2);\r\n        break;\r\n      default: \r\n        break;\r\n    }\r\n    if(inserted) ob.observerArray(inserted)\r\n    return result\r\n  }\r\n})","//  判断当前数据是不是对象\r\nexport function isObject(data) {\r\n  return typeof data === 'object' &&  data !== null\r\n}\r\n\r\n// 定义一个不可枚举的对象\r\nexport function def(data, key, value) {\r\n  Object.defineProperty(data, key, {\r\n    enumerable: false,   // 不可枚举\r\n    configurable: false,  // 不可配置，不可修改\r\n    value\r\n  })\r\n}","import { arrayMethods } from './array.js'\r\nimport { isObject, def } from '../utils/index.js'\r\n\r\nclass Observer{\r\n  constructor(value) {\r\n    // vue如果数据的层侧太多，需要递归去解析对象中的属性，依次增加set和get方法\r\n    // 在被观测的属性上添加一个 __ob__属性，指向Observer这个类，然后被观测的对象身上就能通过 __ob__ 调用Observer类上的方法了\r\n    // value.__ob__ = this\r\n    def(value, '__ob__', this)\r\n    if(Array.isArray(value)) {\r\n      // 如果是数组的话并不会对索引进行观测，会导致性能问题\r\n      // 前端开发中很少直接操作索引 push  shift  unshift  等方法需要重写\r\n      value.__proto__ = arrayMethods\r\n      // 如果数组中放置的是对象，需要在进行观测\r\n      this.observerArray(value)\r\n    }else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n  // 对数组中的每一项进行观测\r\n  observerArray(value) {\r\n    for(let i = 0; i < value.length; i++) {\r\n      observe(value[i])\r\n    }\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data)  // [name, age, address]\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n  // 递归劫持 observe函数中判断了如果不是对象就直接返回\r\n  observe(value)\r\n  // 在获取值和设置值得时候做依赖收集\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if(newValue === value) return \r\n      console.log('值发生变化了', newValue)\r\n      observe(newValue)   //  如果直接修改数据为新对象，需要继续劫持新对象---深度劫持\r\n      value = newValue\r\n    }\r\n  })\r\n}\r\n\r\n// 把data中的属性都使用 Object.defineProperty() 重新定义一遍\r\nexport function observe(data) {\r\n  let isObj = isObject(data)\r\n  if(!isObj) {\r\n    return \r\n  }\r\n  // 用来观测诗句\r\n  return new Observer(data)\r\n}","import { observe } from './observe/index.js'\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  // Vue的数据来源  属性 方法 数据 计算属性 watch 依次初始化\r\n  if(opts.props) {\r\n    initProps(vm)\r\n  }\r\n  if(opts.methods) {\r\n    initMethod(vm)\r\n  }\r\n  if(opts.data) {\r\n    initData(vm)\r\n  }\r\n  if(opts.computed) {\r\n    initComputed(vm)\r\n  }\r\n  if(opts.watch) {\r\n    initWatch(vm)\r\n  }\r\n}\r\n\r\nfunction initProps() {}\r\n\r\nfunction initMethod() {}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  data = vm._data = typeof data === 'function' ? data.call(this) : data\r\n  console.log(data)\r\n  // 对象劫持，用户改变了数据，可以得到通知。 MVVM模式，数据变化可以驱动师徒变化\r\n  // Object.defineProperty() 给属性增加get和set方法，也是响应式原理的主要代码\r\n  observe(data)\r\n}\r\n\r\nfunction initComputed() {}\r\n\r\nfunction initWatch() {}","// AST语法树使用对象来描述js语法的  虚拟DOM使用对象来描述dom节点的\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;   // name-space\r\n// ?: 匹配不捕获\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n\r\nexport function compileToFunction(template) {\r\n  console.log(template)\r\n  return function render() {\r\n\r\n  }\r\n}","import { initState } from './state'\r\nimport { compileToFunction } from './compiler/index.js'\r\n\r\nexport function initMixin(Vue) {\r\n  // 初始化流程\r\n  Vue.prototype._init = function(options) {\r\n    // 数据劫持\r\n    const vm = this\r\n    vm.$options = options   // Vue中的this.$options就是用户传递的属性\r\n    // 初始化装填\r\n    initState(vm)   \r\n\r\n    // 如果用户传入了el属性，就需要将页面渲染出来，也就是要实现挂载流程\r\n    if(vm.$options.el) {\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n\r\n  Vue.prototype.$mount = function(el) {\r\n    const vm = this\r\n    const options = vm.$options\r\n    // 获取dom元素\r\n    el = document.querySelector(el)\r\n    // 默认会先查找有没有render方法，没有render会采用template，template没有就会直接使用el中的内容\r\n    if(!options.render) {\r\n      // 对模板进行编译\r\n      let template = options.template   // 取出模板\r\n      if(!template && el) {\r\n        template = el.outerHTML\r\n      }\r\n      console.log(template)\r\n      // 需要将template转化为render函数；Vue1.0是使用正则替换字符串，性能低。Vue2.0引入了虚拟dom的概念，提升了性能\r\n      const render = compileToFunction(template)\r\n      options.render = render\r\n    }\r\n  }\r\n}\r\n\r\n","import { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n// 调用init.js中的initMixin()方法给Vue原型上添加方法\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","console","log","args","result","apply","inserted","ob","__ob__","slice","observerArray","isObject","data","def","key","value","defineProperty","enumerable","configurable","Observer","isArray","__proto__","walk","i","length","observe","keys","defineReactive","get","set","newValue","isObj","initState","vm","opts","$options","props","initData","computed","watch","_data","call","compileToFunction","template","render","initMixin","Vue","_init","options","el","$mount","document","querySelector","outerHTML"],"mappings":"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"}